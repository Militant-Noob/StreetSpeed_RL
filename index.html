<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>StreetSpeed RL</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <style>
      body {
        margin: 0;
        padding: 20px;
        overflow: auto;
        background: linear-gradient(135deg, #1a1a2e, #0c0c14);
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
      }

      #unity-container {
        position: relative;
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 0 30px rgba(0, 200, 255, 0.5);
        border-radius: 10px;
        overflow: hidden;
        background: #000;
      }

      #unity-canvas {
        width: 100%;
        height: auto;
        display: block;
        max-width: 100%;
        border-radius: 5px;
      }

      #fullscreen-btn {
        margin-top: 15px;
        padding: 12px 25px;
        font-size: 16px;
        background: linear-gradient(135deg, #00c9ff, #92fe9d);
        color: #000;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        font-weight: bold;
        letter-spacing: 1px;
        text-transform: uppercase;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
      }

      #fullscreen-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        background: linear-gradient(135deg, #00e0ff, #a2ffad);
      }

      #fullscreen-btn:active {
        transform: translateY(1px);
      }

      /* Loading Screen Styles */
      #loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #1a1a2e, #16213e);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        transition: opacity 0.5s ease-out;
      }

      #logo {
        width: 300px;
        margin-bottom: 40px;
        animation: pulse 2s infinite;
      }

      .game-title {
        font-size: 2.5rem;
        color: #fff;
        margin-bottom: 50px;
        text-align: center;
        text-shadow: 0 0 10px rgba(0, 255, 255, 0.7);
        letter-spacing: 2px;
      }

      .loading-container {
        width: 80%;
        max-width: 600px;
        text-align: center;
      }

      .progress-text {
        color: #fff;
        font-size: 1.2rem;
        margin-bottom: 15px;
        height: 24px;
      }

      .progress-bar {
        width: 100%;
        height: 20px;
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        overflow: hidden;
        position: relative;
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
      }

      .progress-bar-fill {
        height: 100%;
        background: linear-gradient(90deg, #00c9ff, #92fe9d);
        width: 0%;
        transition: width 0.3s ease;
        border-radius: 10px;
      }

      .loading-info {
        color: #aaa;
        margin-top: 20px;
        font-size: 0.9rem;
        text-align: center;
      }

      @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      .fade-out {
        opacity: 0;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <div id="loading-screen">
      <h1 class="game-title">StreetSpeed RL</h1>
      <div class="loading-container">
        <div class="progress-text" id="progress-text">Initializing...</div>
        <div class="progress-bar">
          <div class="progress-bar-fill" id="progress-bar-fill"></div>
        </div>
        <div class="loading-info">Preparing your racing experience...<br>The game is about 650MB, please be patient</div>
      </div>
    </div>

    <div id="unity-container">
      <canvas id="unity-canvas"></canvas>
    </div>
    
    <button id="fullscreen-btn">Enter Fullscreen</button>

    <script src="Build/RaSei.loader.js"></script>
    <script>
      // Get DOM elements
      const loadingScreen = document.getElementById('loading-screen');
      const progressBarFill = document.getElementById('progress-bar-fill');
      const progressText = document.getElementById('progress-text');
      const canvas = document.getElementById('unity-canvas');
      const container = document.getElementById('unity-container');
      const fullscreenBtn = document.getElementById('fullscreen-btn');
      
      // Function to maintain 16:9 aspect ratio
      function setCanvasSize() {
        const maxWidth = window.innerWidth * 0.9; // Max width is 90% of viewport width
        const maxHeight = window.innerHeight * 0.8; // Max height is 80% of viewport height
        
        // Calculate dimensions maintaining 16:9 aspect ratio
        let width, height;
        
        // Determine which constraint (width or height) is limiting
        const widthBasedHeight = maxWidth * (9/16);
        const heightBasedWidth = maxHeight * (16/9);
        
        if (widthBasedHeight <= maxHeight) {
          // Width is the limiting factor
          width = maxWidth;
          height = widthBasedHeight;
        } else {
          // Height is the limiting factor
          height = maxHeight;
          width = heightBasedWidth;
        }
        
        // Apply dimensions to the canvas
        canvas.width = width;
        canvas.height = height;
        canvas.style.width = width + 'px';
        canvas.style.height = height + 'px';
        
        // Update the container to match canvas dimensions
        container.style.width = width + 'px';
      }
      
      // Initialize canvas size
      setCanvasSize();
      
      // Handle window resize
      window.addEventListener('resize', setCanvasSize);

      // Handle fullscreen functionality
      function requestFullscreen() {
        if (!document.fullscreenElement) {
          const element = document.documentElement;
          if (element.requestFullscreen) {
            element.requestFullscreen();
          } else if (element.webkitRequestFullscreen) {
            element.webkitRequestFullscreen();
          } else if (element.mozRequestFullScreen) {
            element.mozRequestFullScreen();
          } else if (element.msRequestFullscreen) {
            element.msRequestFullscreen();
          }
          
          // Change button text
          fullscreenBtn.textContent = 'Exit Fullscreen';
        } else {
          if (document.exitFullscreen) {
            document.exitFullscreen();
          } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
          } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
          } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
          }
          
          // Change button text
          fullscreenBtn.textContent = 'Enter Fullscreen';
        }
      }

      // Add event listener to the fullscreen button
      fullscreenBtn.addEventListener('click', requestFullscreen);

      // Update button text when fullscreen changes
      document.addEventListener('fullscreenchange', handleFullscreenChange);
      document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
      document.addEventListener('mozfullscreenchange', handleFullscreenChange);
      document.addEventListener('MSFullscreenChange', handleFullscreenChange);

      function handleFullscreenChange() {
        if (document.fullscreenElement || 
            document.webkitFullscreenElement || 
            document.mozFullScreenElement || 
            document.msFullscreenElement) {
          fullscreenBtn.textContent = 'Exit Fullscreen';
        } else {
          fullscreenBtn.textContent = 'Enter Fullscreen';
        }
      }

      // Handle game loading progress
      function showProgress(value, message) {
        // Ensure value is between 0 and 100
        value = Math.min(100, Math.max(0, value));
        
        // Update progress bar
        progressBarFill.style.width = value + '%';
        
        // Update progress text
        if (message) {
          progressText.textContent = message;
        } else {
          progressText.textContent = Math.round(value) + '% loaded';
        }
      }

      // Handle game loaded
      function onGameLoaded() {
        // Fade out loading screen
        loadingScreen.classList.add('fade-out');
        
        // Remove loading screen after fade out animation completes
        setTimeout(() => {
          loadingScreen.style.display = 'none';
        }, 500);
      }

      // Initialize Unity with progress tracking
      createUnityInstance(canvas, {
        dataUrl: "https://media.githubusercontent.com/media/Militant-Noob/StreetSpeed_RL/main/Build/RaSei.data",
        frameworkUrl: "Build/RaSei.framework.js", 
        codeUrl: "Build/RaSei.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "RuptureLabs",
        productName: "StreetSpeed RL",
        productVersion: "1.0",
        showBanner: function(message, type) {
          // Handle Unity messages
          console.log(message, type);
        }
      }, 
      // Progress callback - Unity passes progress from 0 to 1
      function(progress) {
        // Unity reports progress from 0 to 1
        let totalProgress = progress * 100;
        
        if (progress < 0.9) {
          showProgress(totalProgress, `Downloading game data... ${Math.round(totalProgress)}%`);
        } else if (progress < 1.0) {
          showProgress(totalProgress, 'Initializing game... Please wait...');
        } else {
          showProgress(100, 'Starting game...');
          setTimeout(onGameLoaded, 500);
        }
      }).then((unityInstance) => {
        // Game loaded successfully
        console.log('Game loaded successfully');
      }).catch((error) => {
        // Handle loading errors
        console.error('Error loading game:', error);
        progressText.textContent = 'Error loading game. Please refresh the page.';
        progressText.style.color = '#ff6b6b';
      });

      // Mobile device adjustments
      if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        // Adjust canvas for mobile
        canvas.style.width = "100%";
        canvas.style.height = "100%";
      }
    </script>
  </body>
</html>
