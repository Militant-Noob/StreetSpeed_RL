<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>StreetSpeed RL</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: linear-gradient(135deg, #1a1a2e, #0c0c14);
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }

      #unity-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      #unity-canvas {
        width: 100vw;
        height: 100vh;
        display: block;
        max-height: 100vh;
        object-fit: contain;
      }

      /* Loading Screen Styles */
      #loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #1a1a2e, #16213e);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        transition: opacity 0.5s ease-out;
      }

      #logo {
        width: 300px;
        margin-bottom: 40px;
        animation: pulse 2s infinite;
      }

      .game-title {
        font-size: 2.5rem;
        color: #fff;
        margin-bottom: 50px;
        text-align: center;
        text-shadow: 0 0 10px rgba(0, 255, 255, 0.7);
        letter-spacing: 2px;
      }

      .loading-container {
        width: 80%;
        max-width: 600px;
        text-align: center;
      }

      .progress-text {
        color: #fff;
        font-size: 1.2rem;
        margin-bottom: 15px;
        height: 24px;
      }

      .progress-bar {
        width: 100%;
        height: 20px;
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        overflow: hidden;
        position: relative;
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
      }

      .progress-bar-fill {
        height: 100%;
        background: linear-gradient(90deg, #00c9ff, #92fe9d);
        width: 0%;
        transition: width 0.3s ease;
        border-radius: 10px;
      }

      .loading-info {
        color: #aaa;
        margin-top: 20px;
        font-size: 0.9rem;
        text-align: center;
      }

      @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      .fade-out {
        opacity: 0;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <div id="loading-screen">
      <h1 class="game-title">StreetSpeed RL</h1>
      <div class="loading-container">
        <div class="progress-text" id="progress-text">Initializing...</div>
        <div class="progress-bar">
          <div class="progress-bar-fill" id="progress-bar-fill"></div>
        </div>
        <div class="loading-info">Preparing your racing experience...<br>The game is about 650MB, please be patient</div>
      </div>
    </div>

    <div id="unity-container">
      <canvas id="unity-canvas"></canvas>
    </div>

    <script src="Build/RaSei.loader.js"></script>
    <script>
      // Get DOM elements
      const loadingScreen = document.getElementById('loading-screen');
      const progressBarFill = document.getElementById('progress-bar-fill');
      const progressText = document.getElementById('progress-text');
      
      // Set canvas to maintain 16:9 aspect ratio while fitting in the viewport
      const canvas = document.getElementById('unity-canvas');
      function setCanvasSize() {
        // The canvas will maintain 16:9 aspect ratio using CSS object-fit: contain
        // This ensures no cropping while maintaining the aspect ratio
        canvas.style.width = '100%';
        canvas.style.height = '100%';
      }
      
      // Initialize canvas size
      setCanvasSize();
      
      // Handle window resize
      window.addEventListener('resize', setCanvasSize);

      // Handle game loading progress
      function showProgress(value, message) {
        // Ensure value is between 0 and 100
        value = Math.min(100, Math.max(0, value));
        
        // Update progress bar
        progressBarFill.style.width = value + '%';
        
        // Update progress text
        if (message) {
          progressText.textContent = message;
        } else {
          progressText.textContent = Math.round(value) + '% loaded';
        }
      }

      // Handle game loaded
      function onGameLoaded() {
        // Fade out loading screen
        loadingScreen.classList.add('fade-out');
        
        // Remove loading screen after fade out animation completes
        setTimeout(() => {
          loadingScreen.style.display = 'none';
        }, 500);
      }

      // Initialize Unity with progress tracking
      createUnityInstance(canvas, {
        dataUrl: "https://media.githubusercontent.com/media/Militant-Noob/StreetSpeed_RL/main/Build/RaSei.data",
        frameworkUrl: "Build/RaSei.framework.js", 
        codeUrl: "Build/RaSei.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "RuptureLabs",
        productName: "StreetSpeed RL",
        productVersion: "1.0",
        showBanner: function(message, type) {
          // Handle Unity messages
          console.log(message, type);
        }
      }, 
      // Progress callback - Unity passes progress from 0 to 1
      function(progress) {
        // Unity reports progress from 0 to 1
        let totalProgress = progress * 100;
        
        if (progress < 0.9) {
          showProgress(totalProgress, `Downloading game data... ${Math.round(totalProgress)}%`);
        } else if (progress < 1.0) {
          showProgress(totalProgress, 'Initializing game... Please wait...');
        } else {
          showProgress(100, 'Starting game...');
          setTimeout(onGameLoaded, 500);
        }
      }).then((unityInstance) => {
        // Game loaded successfully
        console.log('Game loaded successfully');
      }).catch((error) => {
        // Handle loading errors
        console.error('Error loading game:', error);
        progressText.textContent = 'Error loading game. Please refresh the page.';
        progressText.style.color = '#ff6b6b';
      });

      // Mobile device adjustments
      if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        // Adjust canvas for mobile
        canvas.style.width = "100%";
        canvas.style.height = "100%";
      }
    </script>
  </body>
</html>
